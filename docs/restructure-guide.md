# Wellness Hub 项目重构指南

## 重构概述

本项目已从传统的文件结构重构为现代化的模块化架构，提升了代码的可维护性、可扩展性和团队协作效率。

## 新的文件结构

```
wellness-hub/
├── src/                          # 源代码目录
│   ├── css/                      # 样式文件
│   │   ├── core/                 # 核心样式
│   │   │   ├── variables.css     # CSS 变量定义
│   │   │   ├── reset.css         # 样式重置
│   │   │   └── typography.css    # 字体排版
│   │   ├── components/           # 组件样式
│   │   │   ├── buttons.css       # 按钮组件
│   │   │   ├── cards.css         # 卡片组件
│   │   │   ├── forms.css         # 表单组件
│   │   │   └── layout.css        # 布局组件
│   │   ├── pages/                # 页面样式
│   │   │   ├── navigation.css    # 导航页面
│   │   │   └── games.css         # 游戏页面
│   │   └── utils/                # 工具样式
│   │       └── animations.css    # 动画效果
│   ├── js/                       # JavaScript 文件
│   │   ├── core/                 # 核心模块
│   │   │   ├── config.js         # 应用配置
│   │   │   └── logger.js         # 日志系统
│   │   ├── modules/              # 功能模块
│   │   │   └── api.js            # API 客户端
│   │   ├── utils/                # 工具函数
│   │   │   ├── dom.js            # DOM 操作
│   │   │   └── storage.js        # 存储工具
│   │   ├── components/           # 组件类
│   │   │   └── BaseGame.js       # 游戏基类
│   │   └── pages/                # 页面逻辑
│   │       ├── navigation.js     # 导航页面
│   │       ├── trackers/         # 追踪器页面
│   │       └── games/            # 游戏页面
│   └── templates/                # 模板文件
│       └── base.html             # 基础模板
├── public/                       # 公共资源目录
│   ├── css/                      # 编译后的样式
│   │   └── main.css              # 主样式文件
│   ├── js/                       # 编译后的脚本
│   │   └── main.js               # 主脚本文件
│   └── assets/                   # 静态资源
│       ├── images/               # 图片资源
│       ├── fonts/                # 字体文件
│       └── icons/                # 图标文件
├── pages/                        # 页面文件（迁移目标）
│   ├── trackers/                 # 追踪器页面
│   ├── games/                    # 游戏页面
│   └── user/                     # 用户相关页面
├── backend/                      # 后端代码（保持不变）
├── docs/                         # 文档目录
│   └── restructure-guide.md      # 重构指南
├── scripts/                      # 构建脚本
└── config/                       # 配置文件
```

## 重构亮点

### 1. 模块化架构

#### CSS 模块化
- **核心样式**: 变量、重置、排版等基础样式
- **组件样式**: 可复用的 UI 组件样式
- **页面样式**: 特定页面的样式
- **工具样式**: 动画、工具类等

#### JavaScript 模块化
- **ES6 模块**: 使用现代 JavaScript 模块系统
- **核心模块**: 配置、日志等基础功能
- **功能模块**: API、存储等业务功能
- **组件类**: 可复用的 UI 组件

### 2. 组件化设计

#### BaseGame 基类
所有游戏都继承自统一的基类，提供：
- 生命周期管理
- 状态管理
- 事件系统
- 计时器功能
- 分数系统
- 配置管理

#### 可复用组件
- 按钮、卡片、表单等 UI 组件
- 存储工具、DOM 工具等工具类
- HTTP 客户端、日志系统等服务类

### 3. 现代化工具

#### 日志系统
- 分级日志（ERROR、WARN、INFO、DEBUG）
- 自动日志收集（生产环境）
- 模块化日志记录

#### 存储系统
- LocalStorage 包装类（支持 TTL）
- IndexedDB 操作类
- 统一的存储接口

#### HTTP 客户端
- 统一的 API 调用接口
- 自动重试机制
- 错误处理
- 请求/响应拦截

### 4. 开发体验优化

#### 热重载支持
- 模块化的文件结构便于热重载
- 清晰的依赖关系

#### 类型提示
- JSDoc 注释提供类型信息
- IDE 友好的代码提示

#### 错误处理
- 统一的错误处理机制
- 友好的错误提示
- 错误日志收集

## 迁移指南

### 1. 现有文件迁移

#### HTML 文件
1. 将 HTML 文件移动到 `pages/` 对应子目录
2. 更新 CSS 和 JS 的引用路径
3. 使用新的模板结构

#### CSS 文件
1. 分析现有 CSS，提取可复用组件
2. 将样式分类到对应目录
3. 使用 CSS 变量替换硬编码值
4. 更新类名遵循 BEM 命名规范

#### JavaScript 文件
1. 重构为 ES6 模块
2. 使用新的工具类和基类
3. 添加 JSDoc 注释
4. 统一错误处理

### 2. 新功能开发

#### 创建新页面
1. 在 `src/js/pages/` 创建页面逻辑
2. 在 `src/css/pages/` 创建页面样式
3. 继承适当的基类（如 BaseGame）
4. 遵循统一的代码规范

#### 创建新组件
1. 在 `src/js/components/` 创建组件类
2. 在 `src/css/components/` 创建组件样式
3. 提供完整的生命周期方法
4. 添加事件系统支持

### 3. 开发工作流

#### 本地开发
1. 使用现代浏览器（支持 ES6 模块）
2. 启用本地 HTTP 服务器
3. 配置适当的 MIME 类型

#### 代码规范
1. 使用 ESLint 进行代码检查
2. 使用 Prettier 进行代码格式化
3. 遵循 JavaScript Standard Style
4. 编写完整的 JSDoc 注释

#### 测试策略
1. 单元测试覆盖核心工具类
2. 集成测试验证页面功能
3. 端到端测试确保用户体验

## 兼容性说明

### 浏览器支持
- Chrome 61+
- Firefox 60+
- Safari 10.1+
- Edge 16+

### 功能降级
- 不支持 ES6 模块的浏览器将显示降级提示
- 核心 JavaScript 功能可通过 polyfill 支持
- CSS 变量在不支持的浏览器中回退到默认值

## 性能优化

### 加载优化
- 模块化加载，按需引入
- CSS 和 JS 文件压缩
- 静态资源缓存策略

### 运行时优化
- 事件委托减少内存占用
- 虚拟滚动处理长列表
- 防抖节流优化频繁操作

## 后续规划

### 短期目标
1. 完成所有页面的模块化迁移
2. 添加单元测试覆盖
3. 完善文档和示例

### 中期目标
1. 引入 TypeScript 支持
2. 添加自动化构建流程
3. 实现组件库文档

### 长期目标
1. 微前端架构演进
2. 服务端渲染支持
3. 移动端原生应用

## 常见问题

### Q: 如何添加新的追踪器？
A: 继承 `BaseTracker` 类（如存在），实现特定的业务逻辑，并在 `trackers/` 目录下创建对应文件。

### Q: 如何修改主题？
A: 修改 `src/css/core/variables.css` 中的 CSS 变量，或在运行时通过 JavaScript 动态设置。

### Q: 如何处理 API 错误？
A: 使用统一的 `api` 模块，它会自动处理错误并抛出 `ApiError`，在页面中 catch 并显示友好提示。

### Q: 如何添加新的游戏？
A: 继承 `BaseGame` 类，实现游戏特定的逻辑，使用统一的生命周期和事件系统。

---

**注意**: 本重构保持了向后兼容性，原有的 HTML 文件仍然可以正常工作。建议逐步迁移到新的模块化架构以获得更好的开发体验。